<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>俄罗斯方块</title>
<script src="js/lufylegend-1.9.1.min.js"></script>
<style type="text/css">
*{padding:0;margin:0;height:100%; overflow:hidden;}
#myTetris{height:100%;}
</style>
</head>

<body>
<div id="myTetris">loading...</div>
<script>
var isOver=false,
	row=18,
	col=10,
	size=Math.ceil((document.body.clientWidth-35)/14),
	shapes=["0,1,1,1,2,1,3,1","1,0,1,1,1,2,1,3",
		"1,0,1,1,1,2,2,2","0,2,1,2,2,2,2,1","2,3,2,2,2,1,1,1","3,1,2,1,1,1,1,2",
		"2,0,2,1,2,2,1,2","0,1,1,1,2,1,2,2","1,3,1,2,1,1,2,1","3,2,2,2,1,2,1,1",
		"0,1,1,1,1,2,2,2","1,3,1,2,2,2,2,1",
		"3,1,2,1,2,2,1,2","1,0,1,1,2,1,2,2",
		"1,1,2,1,2,2,1,2",
		"1,1,0,2,1,2,2,2","1,2,2,3,2,2,2,1","2,2,3,1,2,1,1,1","2,1,1,0,1,1,1,2"],
	colors=['#af0000','#007900','#578eff','#707070'],
	level=0,
	levelTime=500,
	score=0,
	clock;
var clientWidth,
	clientHeight,
	backLayer,
	gameLayer,
	nextLayer,
	scoreLayer,
	levelLayer,
	nextTextTitle,
	scoreTextTitle,
	levelTextTitle,
	scoreText,
	levelText;
function Tetris(tp){
	this.blocks = [1,1,1,1];
	this.color = null;
	this.nextColor = null;
	this.shape = null;
	this.nextShape = null;
	this.left = null;
	this.top = null;
}
Tetris.prototype.fresh = function(){
	
}
function gameStart(){
	gameArea();
}
function gameArea(){
	backLayer.removeAllChild();	
	gameLayer = new LSprite();
	var gameWidth = col*size+col+3;
	gameLayer.graphics.drawRect(0,'#333333',[5,5,gameWidth,row*size+row+3],true,'#333333');
	gameLayer.graphics.drawRect(0,'#cccccc',[6,6,gameWidth-2,row*size+row+1],true,'#cccccc');
	backLayer.addChild(gameLayer);
	scoreLayer = new LSprite();
	var rightWidth = clientWidth-gameWidth-15;
	scoreLayer.graphics.drawRect(0,'#333333',[gameWidth+10,35,rightWidth,35],true,'#333333');
	scoreLayer.graphics.drawRect(0,'#cccccc',[gameWidth+11,36,rightWidth-2,33],true,'#cccccc');
	scoreTextTitle = new LTextField();
	scoreTextTitle.text = '得分:';
	scoreTextTitle.size = 12;
	scoreTextTitle.color = '#333333';
	scoreTextTitle.x = gameWidth+10;
	scoreTextTitle.y = 14;
	scoreTextTitle.weight = 'bold';
	scoreLayer.addChild(scoreTextTitle);
	scoreText = new LTextField();
	scoreText.text = '0';
	scoreText.size = 12;
	scoreText.color = '#333333';
	scoreText.x = gameWidth+15;
	scoreText.y = 44;
	scoreLayer.addChild(scoreText);
	backLayer.addChild(scoreLayer);
	levelLayer = new LSprite();
	levelLayer.graphics.drawRect(0,'#333333',[gameWidth+10,95,rightWidth,35],true,'#333333');
	levelLayer.graphics.drawRect(0,'#cccccc',[gameWidth+11,96,rightWidth-2,33],true,'#cccccc');
	levelTextTitle = new LTextField();
	levelTextTitle.text = '等级:';
	levelTextTitle.size = 12;
	levelTextTitle.color = '#333333';
	levelTextTitle.x = gameWidth+10;
	levelTextTitle.y = 74;
	levelTextTitle.weight = 'bold';
	levelLayer.addChild(levelTextTitle);
	levelText = new LTextField();
	levelText.text = '0';
	levelText.size = 12;
	levelText.color = '#333333';
	levelText.x = gameWidth+15;
	levelText.y = 104;
	levelLayer.addChild(levelText);
	backLayer.addChild(levelLayer);
	nextLayer = new LSprite();
	nextLayer.graphics.drawRect(0,'#333333',[gameWidth+10,155,rightWidth,rightWidth],true,'#333333');
	nextLayer.graphics.drawRect(0,'#cccccc',[gameWidth+11,156,rightWidth-2,rightWidth-2],true,'#cccccc');
	nextTextTitle = new LTextField();
	nextTextTitle.text = '下个图形:';
	nextTextTitle.size = 12;
	nextTextTitle.color = '#333333';
	nextTextTitle.x = gameWidth+10;
	nextTextTitle.y = 134;
	nextTextTitle.weight = 'bold';
	nextLayer.addChild(nextTextTitle);
	backLayer.addChild(nextLayer);
}
function gameInit(){
	var title = new LTextField();
	title.size = 30;
	title.text = '俄罗斯方块';
	title.x = (clientWidth - title.getWidth())/2;
	title.y = 100;
	title.color = '#333333';
	backLayer.addChild(title);
	var clickText = new LTextField();
	clickText.size = 20;
	clickText.text = '点击此处开始游戏';
	var clickTextLeft = (clientWidth - clickText.getWidth())/2;
	clickText.x = clickTextLeft;
	clickText.y = 300;
	clickText.color = '#333333';
	var clickLayer = new LSprite();
	clickLayer.graphics.drawRect(1,'#333333',[clickTextLeft-10,290,clickText.getWidth()+20,40]);
	clickLayer.addChild(clickText);
	backLayer.addChild(clickLayer);
	clickLayer.addEventListener(LMouseEvent.MOUSE_UP,gameStart);
}
function main(){  
	backLayer = new LSprite();
	backLayer.graphics.drawRect(1,'#eeeeee',[0,0,clientWidth,clientHeight],true,'#eeeeee');
	addChild(backLayer);
	gameInit();
}
(function(){
	clientWidth = document.getElementById('myTetris').offsetWidth;
	clientHeight = document.getElementById('myTetris').offsetHeight;
	init(50,"myTetris",clientWidth,clientHeight,main);
})();
</script>
</body>
</html>